	SUBROUTINE EPUR4(IDIM,ICARD,X,Y,ID,MOD,PEX,KP,KLIC,KODE,NOR)
	DIMENSION X(IDIM),Y(IDIM),ID(IDIM),KLIC(500)
	COMMON /ENSOR/LEC,IMP	
        DATA SEUIL/1.0E-07/
	IF (PEX.LE.0.0) RETURN
	KODE=0
	N1=ICARD+1
	IF (N1.GT.IDIM) GOTO 100
	X(N1)=0.0
	Y(N1)=0.0
	IF (NOR.NE.1) N1=ICARD
	SX=0.0
	SY=0.0
	DO 10 I=1,ICARD
	SX=SX+X(I)*X(I)
10	SY=SY+Y(I)*Y(I)
	SX=SQRT(SX/FLOAT(ICARD))
	SY=SQRT(SY/FLOAT(ICARD))
	PX=PEX*SX
	PY=PEX*SY
	KP=0
	PIN=PEX+20.0
	DO 30 I=1,ICARD
	IF (ABS(X(I)).GT.PX) GOTO 20
	IF (ABS(Y(I)).LE.PY) GOTO 30
20	KP=KP+1
	IF (MOD.NE.1.AND.KP.EQ.1) WRITE(IMP,120) PEX
	IF (MOD.NE.1.AND.KP.EQ.1) WRITE(IMP,130)
	IF (KP.GT.500) GOTO 100
	KLIC(KP)=I
	IF (MOD.NE.1) WRITE(IMP,110) ID(I),X(I),Y(I)
	X(I)=X(I)/PIN
	Y(I)=Y(I)/PIN
30	CONTINUE
	IF (KP.EQ.0) GOTO 90
	IF (MOD.EQ.4) WRITE(IMP,130)
	CALL BORNS(IDIM,N1,Y,YMIN,YMAX)
	CALL BORNS(IDIM,N1,X,XMIN,XMAX)
	IF (XMIN.EQ.0.) XMIN=SEUIL
	IF (XMAX.EQ.0.) XMAX=SEUIL
	T1=YMAX/XMAX
	T2=YMAX/XMIN
	T3=YMIN/XMIN
	T4=YMIN/XMAX
	DO 80 K=1,KP
	KLK=KLIC(K)
	U=X(KLK)
	V=Y(KLK)
	IF (U.EQ.0.) U=SEUIL
	T=V/U
	A=YMAX
	IF (U.GT.0.0.AND.(T4.LT.T.AND.T.LT.T1)) GOTO 40
	IF (U.LT.0.0.AND.(T2.LT.T.AND.T.LT.T3)) GOTO 50
	IF (V.LT.0.) A=YMIN
	V=A
	IF (T.EQ.0.) T=SEUIL
	U=A/T
	GOTO 70
40	A=XMAX
	GOTO 60
50	A=XMIN
60	U=A
	V=A*T
70	CONTINUE
	IF (V.GT.YMAX) V=YMAX
	IF (U.GT.XMAX) U=XMAX
	X(KLK)=U
	Y(KLK)=V
80	CONTINUE
	IF (KP.NE.0.AND.MOD.EQ.1) WRITE(IMP,140) KP,PEX
90	CONTINUE
	RETURN
100	KODE=1
	RETURN
110	FORMAT(1H ,2H *,A4,1X,1H*,2(F15.5,8X,1H*))
120	FORMAT(///1H ,25X,9HATTENTION//1H ,
     1         39HLES POINTS CI-DESSOUS ETAIENT A PLUS DE ,F5.1,
     2	       24H  ECARTS-TYPES DU CENTRE /1H ,11HILS ONT ETE,
     3         34H RAMENES SUR LE CADRE DU GRAPHIQUE  //)
130 	FORMAT(1H ,28(2H *))
140	FORMAT(1H ,5X,I4,18H  POINTS A PLUS DE ,F5.1,14H  ECARTS-TYPES,
     1        42H DE L'ORIGINE ONT ETE RAMENES SUR LE CADRE)
	END
