	SUBROUTINE GPLAN(IDIM,ICARD,JX,JY,X,Y,ID,MOD,NLIGN,NPAGE,PEX,NOR)
	DIMENSION ID(IDIM),LD1(500),LD2(500),KLAC(500)
	DIMENSION LA(6),MA(6),NA(6),EX(12),KLIC(500)
	DIMENSION X(IDIM),Y(IDIM)
	DIMENSION XD1(500),YD1(500),XD2(500),YD2(500)
	COMMON /ENSOR/LEC,IMP
	character*1 cma(6)
	character*4 cna(6)
	integer*4 na(6)
	equivalence (na,cna)
	integer*4 ma(6)
	equivalence (ma,cma)
	DATA cMA/1H-,1H ,1H!,1H!,1H.,1H+/
	DATA cNA/4H----,4H    ,4H!   ,4H   !,4H .  ,4H +  /
	N1=ICARD
	IF (NOR.EQ.1) N1=ICARD+1
	IF (N1.GT.IDIM) WRITE(IMP,1130)
	WRITE(IMP,1110) ICARD,JX,JY,JX,JY
	CALL EPUR4(IDIM,ICARD,X,Y,ID,MOD,PEX,KP,KLIC,KODE,NOR)
	IF (KODE.EQ.1) GOTO 160
	WRITE(IMP,1000)
	DO 10 K=1,6
	LA(K)=NA(K)
10	IF (MOD.EQ.1) LA(K)=MA(K)
	IF (NOR.NE.1) GOTO 20
	ID(N1)=LA(6)
	X(N1)=0.0
	Y(N1)=0.0
20	CALL BORNS(IDIM,N1,X,XMIN,XMAX)
	CALL BORNS(IDIM,N1,Y,YMIN,YMAX)
	IF (MOD.EQ.1) K1=123
	IF (MOD.EQ.4) K1=30
	K2=K1+1
	K3=K1*NPAGE
	NL=NLIGN
	FC=K3
	FPAGE=NPAGE
	IF (NL.NE.0) GOTO 30
	NL=((YMAX-YMIN)/(XMAX-XMIN))*FPAGE*74.0
30	IF (NL.LE.12) NL=12
	FL=NL
	S=(XMAX-XMIN)/FC
	T=(YMAX-YMIN)/FL
	NINT=5*NPAGE+1
	ESPX=FC/(5.0*NPAGE)
	DO 40 J=1,NINT
40	EX(J)=XMIN+S*ESPX*FLOAT(J-1)
	KKO=0.50001-(XMIN/S)
	LLO=0.50001+ABS(YMAX/T)
	DO 50 I=1,N1
	K=(X(I)-XMIN)/S+0.500001
	L=(YMAX-Y(I))/T+0.500001
	IF (K.EQ.0) K=1
	IF (L.EQ.0) L=1
	X(I)=K+0.0001
50	Y(I)=L+0.0001
	KPT=0
55	KPT=KPT+1
	J=0
	DO 130 LL=1,NL
	EY=YMAX-T*FLOAT(LL-1)
	DO 60 KK=1,K3
	KLIC(KK)=0
	KLAC(KK)=LA(2)
	IF (KK.EQ.KKO.OR.LL.EQ.LLO) KLAC(KK)=LA(5)
60	CONTINUE
	KLAC(1)=LA(3)
	KLAC(K3)=LA(4)
	DO 90 I=1,N1
	L=Y(I)
	IF (L.NE.LL) GOTO 90
	K=X(I)
	IF (KLIC(K)) 80,70,80
70	KLIC(K)=I
	GOTO 90
80	IK=KLIC(K)
	J=J+1
	IF (MOD.EQ.1) GOTO 90
	IF (J.GT.500) GOTO 160
	LD1(J)=ID(IK)
	XD1(J)=X(IK)*S+XMIN
	YD1(J)=YMAX-Y(IK)*T
	LD2(J)=ID(I)
	XD2(J)=X(I)*S+XMIN
	YD2(J)=YMAX-Y(I)*T
90	CONTINUE
	DO 100 KK=1,K3
	IF (LL.EQ.1.OR.LL.EQ.NL) KLAC(KK)=LA(1)
	IK=KLIC(KK)
	IF (IK.NE.0) KLAC(KK)=ID(IK)
100	CONTINUE
	IF (MOD.NE.1) GOTO 120
110	IF (KPT.EQ.1) WRITE(IMP,1010) EY,(KLAC(K),K=1,K1)
	IF (KPT.EQ.2) WRITE(IMP,1030) (KLAC(K),K=K2,K3),EY
	GOTO 130
120	IF (KPT.EQ.1) WRITE(IMP,1020) EY,(KLAC(K),K=1,K1)
	IF (KPT.EQ.2) WRITE(IMP,1040) (KLAC(K),K=K2,K3),EY
130	CONTINUE
	IF (KPT.EQ.1) WRITE(IMP,1050) (EX(K),K=1,6)
	IF (NPAGE.EQ.2.AND.KPT.EQ.1) WRITE(IMP,1000)
	IF (NPAGE.GT.KPT) GOTO 55
	IF (KPT.EQ.2) WRITE(IMP,1060) (EX(K),K=7,11)
	IF (J.EQ.0.OR.MOD.EQ.1) GOTO 150
	WRITE(IMP,1070)
	WRITE(IMP,1080)
	DO 140 L=1,J
140	WRITE(IMP,1090) LD1(L),XD1(L),YD1(L),LD2(L),XD2(L),YD2(L)
	WRITE(IMP,1080)
150	CONTINUE
	IF (J.NE.0.AND.MOD.EQ.1) WRITE(IMP,1100) J
	RETURN
160	WRITE(IMP,1120)
	RETURN
1000	FORMAT(1H1)
1010	FORMAT(1H ,F8.3,1X,123A1)
1020	FORMAT(1H ,F8.3,2X,30A4)
1030	FORMAT(1H ,123A1,1X,F8.3)
1040	FORMAT(1H ,30A4,2X,F8.3)
1050	FORMAT(1H ,2X,5(F10.3,14X),F10.3)
1060	FORMAT(1H ,18X,4(F10.3,14X),F10.3)
1070	FORMAT(///1H ,50X,28HPOINTS MULTIPLES PAR COUPLE /
     1	/1H ,2(8H POINT *,8X,8HABSCISSE,7X,1H*,8X,8HORDONNEE,7X,
     2  1H*,10X)/1H ,8H   VU  *,2(8X,9HAPPROCHEE,6X,1H*),10X,
     3  8H CACHE *,2(8X,9HAPPROCHEE,6X,1H*))
1080	FORMAT(1H ,2(28(2H *),10X))
1090	FORMAT(1H ,2(2H *,A4,2H *,2(F15.5,8X,1H*),10X))
1100	FORMAT(/1H ,30H NOMBRE DE POINTS DOUBLES =   ,I5/)
1110	FORMAT(1H1,25X,22HPLAN DE PROJECTION DES ,I6,8H  POINTS,
     1	  14H SUR LES AXES  ,I2,6H  ET  ,I2/1H ,130(1H-)//1H ,30X,
     2     4HAXE ,I2,14H  /HORIZONTAL ,10X,4HAXE ,I2,12H /VERTICAL //)
1120	FORMAT(///1H ,10X,16HGRAPHIQUE REFUSE  /
     1   1H ,10X,37HSOIT PLUS DE 500 POINTS DOUBLES EN A4/
     2   1H ,10X,36HSOIT PLUS DE 500 POINTS SUR LE CADRE/1H1)
1130	FORMAT(/1H ,47H(ATTENTION  DEFAUT DE DIMENSION DANS S/P GPLAN)/)
	END
