	SUBROUTINE VVPRO(NDIM,N,W,D)
	DIMENSION W(NDIM,NDIM),D(NDIM)
	DATA EPSIL/0.000001/
	RN=N
	W2=0	
	DO 10 L=1,N
	DO 10 K=1,N
10	W2=W2+W(L,K)*W(L,K)
	EP=EPSIL*W2/RN
	NI=N*(N-1)/2
       	KI=NI
	N1=N-1
15	CONTINUE
	DO 140 K=1,N1
	K1=K+1
	DO 140 KP=K1,N
	W2=0.
	WW=0.
	DO 20 L=1,N
	W2=W2+W(L,K)*W(L,KP)
20	WW=WW+(W(L,K)+W(L,KP))*(W(L,K)-W(L,KP))
	W22=W2*2.
	W2A=ABS(W22)
	IF (W2A-EP) 30,40,40
30	IF (WW) 40,130,130
40	WWA=ABS(WW)
	IF (W2A-WWA) 50,50,60
50	TTETA=W2A/WWA
	CTETA=1./SQRT(1.+TTETA**2)
	STETA=TTETA*CTETA
	GOTO 70
60	ATETA=WWA/W2A
	STETA=1./SQRT(1.+ATETA**2)
	CTETA=ATETA*STETA
70	CTETA=SQRT((1.+CTETA)/2.)
	STETA=STETA/(2.*CTETA)	
	IF (WW) 80,90,90
80	FLIP=CTETA
	CTETA=STETA 	             
	STETA=FLIP
90	IF (W22) 100,110,110
100	STETA=-STETA
110	CONTINUE
	DO 120 L=1,N
	FLIP=W(L,K)
	W(L,K)=FLIP*CTETA+W(L,KP)*STETA
120	W(L,KP)=-FLIP*STETA+W(L,KP)*CTETA
	KI=NI
	GOTO 140          
130	KI=KI-1
	IF (KI) 150,150,140
140	CONTINUE
	GOTO 15
150	CONTINUE
	DO 170 K=1,N
	D(K)=0.
	DO 160 L=1,N
160	D(K)=D(K)+W(L,K)*W(L,K)
170	D(K)=SQRT(D(K))
	DO 180 K=1,N
	DO 180 L=1,N
180	W(L,K)=W(L,K)/D(K)
	RETURN
	END
